# Railway Configuration for MLOOK DTS
# This file configures the main web service

[build]
builder = "nixpacks"
# Build command: Install dependencies and build frontend assets
buildCommand = "composer install --no-dev --optimize-autoloader && npm ci && npm run build"

[deploy]
# Start command: Simple web server first (for debugging)
# Use role-aware start script so multiple services can share the same config
startCommand = "chmod +x start.sh && ./start.sh"
# Health check: Use Laravel's built-in /up endpoint (doesn't require database)
healthcheckPath = "/up"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

# IMPORTANT: Configure in Railway UI:
# Pre-deploy Command (Settings â†’ Deploy Hooks):
#   php artisan migrate --force --seed
#
# NOTE: This script runs queue worker and web server in one container.
# For Reverb, you still need a separate service (it needs its own port).
# Alternative: Create separate services for better isolation and scaling.

